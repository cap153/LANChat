<!DOCTYPE html>
<html>
<head>
    <title>简单文件上传测试</title>
</head>
<body>
    <h1>文件上传测试</h1>
    
    <div>
        <label>目标地址:</label>
        <input type="text" id="target-addr" value="localhost:8888" style="width: 300px;">
    </div>
    
    <div style="margin-top: 10px;">
        <label>Peer ID:</label>
        <input type="text" id="peer-id" value="test-peer-123" style="width: 300px;">
    </div>
    
    <div style="margin-top: 10px;">
        <label>选择文件:</label>
        <input type="file" id="file-input">
    </div>
    
    <div style="margin-top: 10px;">
        <button onclick="uploadFile()">上传文件</button>
    </div>
    
    <div id="result" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc;"></div>
    
    <script>
        async function uploadFile() {
            const fileInput = document.getElementById('file-input');
            const targetAddr = document.getElementById('target-addr').value;
            const peerId = document.getElementById('peer-id').value;
            const resultDiv = document.getElementById('result');
            
            if (!fileInput.files[0]) {
                resultDiv.innerHTML = '<span style="color: red;">请选择文件</span>';
                return;
            }
            
            const file = fileInput.files[0];
            const formData = new FormData();
            formData.append('file', file);
            formData.append('peer_id', peerId);
            
            const uploadUrl = `http://${targetAddr}/api/upload`;
            
            resultDiv.innerHTML = `<p>正在上传到: ${uploadUrl}</p>
                                   <p>文件: ${file.name} (${file.size} 字节)</p>
                                   <p>Peer ID: ${peerId}</p>`;
            
            try {
                const resp = await fetch(uploadUrl, {
                    method: 'POST',
                    body: formData,
                    mode: 'cors',
                });
                
                resultDiv.innerHTML += `<p>响应状态: ${resp.status} ${resp.statusText}</p>`;
                
                if (!resp.ok) {
                    const errorText = await resp.text();
                    resultDiv.innerHTML += `<p style="color: red;">错误: ${errorText}</p>`;
                    return;
                }
                
                const data = await resp.json();
                resultDiv.innerHTML += `<p style="color: green;">成功!</p>
                                        <pre>${JSON.stringify(data, null, 2)}</pre>`;
            } catch (e) {
                resultDiv.innerHTML += `<p style="color: red;">异常: ${e.message}</p>`;
            }
        }
    </script>
</body>
</html>
